<%- include('../partials/html-head') %>
<% if (user.profile._id.toString() === profile._id.toString()) { %>
  <style>
    #profile-dropdown {
      display: none;
    }
  </style>
<% } %>
<%- include('../partials/nav') %>

<div id="home">
  <section class="text-secondary px-4 py-5 text-center">
    <% if (profile.avatar) { %>
      <img
        class="image-rounded" 
        src="<%= profile.avatar %>" 
        alt="<%= profile.name %>'s avatar"
      >
    <% } else {%>
      <img
        src="/images/icons/user.png" 
        alt="A placeholder avatar"
      >
    <% } %> 
    <h1 class="display-5 fw-bold text-white pt-2"><%= profile.name %></h1>
    <div class="container py-4">
      <table class="table table-light table-striped align-middle">
        <tbody>
          <% if (user.profile._id.toString() === profile._id.toString()) { %>
            <tr>
              <td>Google Email:</td>
              <td><%= user.email %></td>
            </tr>
          <% } %>
          <tr>
            <td>Name:</td>
            <td><%= profile.name %></td>
          </tr>
          <tr>
            <td>Gamer Tag:</td>
            <td><%= profile.gamerTag %></td>
          </tr>
          <tr>
            <td>Platform:</td>
            <td><%= profile.platform %></td>
          </tr>
          <tr>
            <td>Avatar URL:</td>
            <td>
              <a href="<%= profile.avatar %>">
                <%= profile.avatar.substring(0, 35) %>
                <% if (profile.avatar.length > 35) { %>
                ...
                <% } %>
              </a>
            </td>
          </tr>
        </tbody>
      </table>
    </div>
    <div class="container">
      <div class="row">
          <div class="col-lg-3" id="sidePanel">
           
          </div>
          <div class="col-lg-6" id="threadList" >
              <div class="container">
                <h2 class=""><%= profile.gamerTag %>'s Posts</h2>
                <div class="list-group">
                <%# This is where we'll display our friends %>
                <% posts.forEach(post => { %>
                      <div class="card-body list-group-item">
                        <p class="card-title fs-4 text-dark"><% post.leader %></p>
                        <p class="card-text fs-5 text-dark">
                          Title: <%= post.title %>
                        </p>
                        <p class="card-text fs-5 text-dark">
                          Available Positions:
                        </p>
                          <p>Support <%= post.support1 ? "Filled" :"Not Filled" %> </p>
                          <p>Support <%= post.support2 ? "Filled" : "Not Filled" %></p> 
                          <p>DPS <%= post.dps1 ? "Filled" : "Not Filled" %> </p>
                          <p>DPS <%= post.dps2 ? "Filled" : "Not Filled" %> </p>
                          <p>TANK <%= post.tank1 ? "Filled" : "Not Filled" %> </p>
                          <p>Tank <%= post.tank2 ? "Filled" : "Not Filled" %> </p>
                      
                        <a 
                          href="/posts/<%=post.postId%>" 
                          class="btn btn-primary list-group-item-action"
                        >
                          Details
                        </a>
                      </div>
                <% }) %>
                    </div>
            </div>     
          </div>
          <div class="col-lg-3" id="friendsList">
            <% if (user.profile._id.toString() === profile._id.toString()) { %>
              <%# This is where we'll add the UI to edit a profile %> 
              <div class="list-group">
              <a 
                class="list-group-item list-group-item-action btn btn-warning align-center"
                role="button" 
                href="/profile/<%= profile._id %>/edit"
              >
                Edit Profile
              </a>
            <a 
                class="list-group-item list-group-item-action btn btn-danger my-5"
                role="button" 
                href="/auth/logout"
              >
                Logout
              </a>
            </div>
            <% } %>
            <%# This is where we'll add a button to 'friend/unfriend' a user %> 
            <%# if this is not my profile page          &&  the user being viewed is not in my friends list %> 
            <% if (!profile._id.equals(userProfile._id) && !userProfile.followers.includes(profile._id)) { %>
              <a href="/profiles/<%= profile._id %>/follow" class="btn btn-primary">
                Add Friend
              </a>
            <% } %>
            <%# if this is not my profile page          &&  the user being viewed is in my friends list %> 
            <% if (!profile._id.equals(userProfile._id) && userProfile.followers.includes(profile._id)) { %>
              <a href="/profiles/<%= profile._id %>/unfollow" class="btn btn-primary">
                Remove Friend
              </a>
            <% } %>
          </div>
  </div>

  </section>
 
</div>

<%- include('../partials/footer') %>